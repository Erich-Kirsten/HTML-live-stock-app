<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio Tracking - StockMarket Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        :root {
            --primary-color: #02c076;
            --secondary-color: #1a1a1a;
            --dark-bg: #0d1421;
            --card-bg: #1e2329;
            --text-light: #b7bdc6;
            --border-color: #2b3139;
            --danger-color: #f6465d;
            --warning-color: #ffa726;
        }

        body {
            background: linear-gradient(135deg, var(--dark-bg) 0%, #1a2332 100%);
            color: white;
            min-height: 100vh;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        .navbar {
            background: var(--card-bg) !important;
            border-bottom: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        .navbar-brand {
            font-weight: 700;
            color: var(--primary-color) !important;
        }

        .nav-link {
            color: var(--text-light) !important;
            transition: all 0.3s ease;
        }

        .nav-link:hover, .nav-link.active {
            color: var(--primary-color) !important;
        }

        .portfolio-header {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }

        .portfolio-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary-color), var(--warning-color));
        }

        .portfolio-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            border-color: var(--primary-color);
            box-shadow: 0 10px 30px rgba(2, 192, 118, 0.1);
        }

        .stat-card h6 {
            color: var(--text-light);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-change {
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .positive { color: var(--primary-color); }
        .negative { color: var(--danger-color); }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .btn-primary {
            background: var(--primary-color);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: #029960;
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(2, 192, 118, 0.3);
        }

        .btn-outline-primary {
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            background: transparent;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-1px);
        }

        .holdings-table {
            background: var(--card-bg);
            border-radius: 15px;
            border: 1px solid var(--border-color);
            overflow: hidden;
        }

        .table {
            color: white;
            margin-bottom: 0;
        }

        .table thead th {
            background: var(--secondary-color);
            border: none;
            padding: 1rem;
            font-weight: 600;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .table tbody td {
            background: var(--card-bg);
            border: none;
            padding: 1rem;
            vertical-align: middle;
        }

        .table tbody tr {
            border-bottom: 1px solid var(--border-color);
        }

        .table tbody tr:hover {
            background: rgba(2, 192, 118, 0.05);
        }

        .stock-symbol {
            font-weight: 700;
            color: var(--primary-color);
        }

        .stock-name {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        .action-btn {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-light);
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            margin-right: 0.5rem;
        }

        .action-btn:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .action-btn.sell:hover {
            border-color: var(--danger-color);
            color: var(--danger-color);
        }

        .modal-content {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 15px;
        }

        .modal-header {
            border-bottom: 1px solid var(--border-color);
        }

        .modal-footer {
            border-top: 1px solid var(--border-color);
        }

        .form-control {
            background: var(--dark-bg);
            border: 1px solid var(--border-color);
            color: white;
            border-radius: 8px;
            padding: 0.75rem;
        }

        .form-control:focus {
            background: var(--dark-bg);
            border-color: var(--primary-color);
            color: white;
            box-shadow: 0 0 0 0.2rem rgba(2, 192, 118, 0.25);
        }

        .form-label {
            color: var(--text-light);
            font-weight: 500;
            margin-bottom: 0.5rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-light);
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--border-color);
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .portfolio-header {
                padding: 1.5rem;
            }

            .action-buttons {
                flex-direction: column;
            }

            .table-responsive {
                font-size: 0.9rem;
            }

            .stat-value {
                font-size: 1.5rem;
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .price-change {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-weight: 600;
        }

        .badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container">
            <a class="navbar-brand" href="/index.html">
                <i class="fas fa-chart-line me-2"></i>EquiZen
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/News&Stocks.html">News & Stocks</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/Portfolio.html">Portfolio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/ProVersion.html">Pro Version</a>
                    </li>
                </ul>
                <div class="d-flex align-items-center">
                    
                    <!-- Auth Buttons (shown when logged out) -->
                    <div id="authButtons" class="d-flex">
                        <button class="btn btn-outline-light me-3" data-bs-toggle="modal" data-bs-target="#loginModal">
                            <i class="fas fa-sign-in-alt me-2"></i>Log In
                        </button>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#signupModal">
                            <i class="fas fa-user-plus me-2"></i>Sign Up
                        </button>
                    </div>
                    
                    <!-- User Info (shown when logged in) -->
                    <div id="userSection" class="d-none">
                        <div class="user-info d-flex align-items-center">
                            
                            <span id="apiStatus" class="api-status me-3 connecting">
                        <a class="nav-link" href="/index-2.html">TradingView</a>
                    </span>
                            <i class="fas fa-user-circle fs-4 me-2 text-primary"></i>
                            <span id="userName" class="me-3 fw-medium">Welcome!</span>
                            <button id="logoutBtn" class="btn btn-outline-danger btn-sm">
                                <i class="fas fa-sign-out-alt me-1"></i>Logout
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>


    <!-- Login Modal -->
    <div class="modal fade auth-modal" id="loginModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-white">
                        <i class="fas fa-sign-in-alt me-2"></i>Welcome Back
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="loginEmail" class="form-label text-white">Email Address</label>
                            <input type="email" class="form-control" id="loginEmail" required>
                        </div>
                        <div class="mb-4">
                            <label for="loginPassword" class="form-label text-white">Password</label>
                            <input type="password" class="form-control" id="loginPassword" required>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-sign-in-alt me-2"></i>Sign In
                            </button>
                        </div>
                        <div class="text-center mt-3">
                            <small class="text-muted">Don't have an account? 
                                <a href="#" class="text-primary" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#signupModal">Sign up here</a>
                            </small>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Signup Modal -->
    <div class="modal fade auth-modal" id="signupModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title text-white">
                        <i class="fas fa-user-plus me-2"></i>Create Account
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <form id="signupForm">
                        <div class="mb-3">
                            <label for="signupName" class="form-label text-white">Full Name</label>
                            <input type="text" class="form-control" id="signupName" required>
                        </div>
                        <div class="mb-3">
                            <label for="signupEmail" class="form-label text-white">Email Address</label>
                            <input type="email" class="form-control" id="signupEmail" required>
                        </div>
                        <div class="mb-4">
                            <label for="signupPassword" class="form-label text-white">Password</label>
                            <input type="password" class="form-control" id="signupPassword" required>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-user-plus me-2"></i>Create Account
                            </button>
                        </div>
                        <div class="text-center mt-3">
                            <small class="text-muted">Already have an account? 
                                <a href="#" class="text-primary" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#loginModal">Sign in here</a>
                            </small>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-4">
        <!-- Portfolio Header -->
        <div class="portfolio-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-2"><i class="fas fa-briefcase me-2"></i>My Portfolio</h1>
                    <p class="text-muted mb-0">Track your virtual investments and simulate trading</p>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="badge bg-success fs-6 px-3 py-2">
                        <i class="fas fa-coins me-1"></i>Virtual Trading
                    </div>
                </div>
            </div>
        </div>

        <!-- Portfolio Statistics -->
        <div class="portfolio-stats">
            <div class="stat-card">
                <h6>Total Portfolio Value</h6>
                <div class="stat-value" id="totalValue">$25,450.00</div>
                <div class="stat-change positive">
                    <i class="fas fa-arrow-up"></i>
                    <span>+$1,245.00 (+5.14%)</span>
                </div>
            </div>
            <div class="stat-card">
                <h6>Total Invested</h6>
                <div class="stat-value" id="totalInvested">$24,205.00</div>
                <div class="stat-change">
                    <i class="fas fa-wallet"></i>
                    <span>Initial Investment</span>
                </div>
            </div>
            <div class="stat-card">
                <h6>Available Cash</h6>
                <div class="stat-value" id="availableCash">$5,750.00</div>
                <div class="stat-change">
                    <i class="fas fa-dollar-sign"></i>
                    <span>Ready to Invest</span>
                </div>
            </div>
            <div class="stat-card">
                <h6>Total Gain/Loss</h6>
                <div class="stat-value positive" id="totalGainLoss">+$1,245.00</div>
                <div class="stat-change positive">
                    <i class="fas fa-trending-up"></i>
                    <span>+5.14% Today</span>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#buyModal">
                <i class="fas fa-plus me-2"></i>Buy Stock
            </button>
            <button class="btn btn-outline-primary" onclick="refreshPrices()">
                <i class="fas fa-sync-alt me-2"></i>Refresh Prices
            </button>
            <button class="btn btn-outline-primary" onclick="exportPortfolio()">
                <i class="fas fa-download me-2"></i>Export
            </button>
        </div>

        <!-- Holdings Table -->
        <div class="holdings-table">
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Stock</th>
                            <th>Shares</th>
                            <th>Avg. Price</th>
                            <th>Current Price</th>
                            <th>Market Value</th>
                            <th>Gain/Loss</th>
                            <th>Change %</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="holdingsTableBody">
                        <!-- Holdings will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Buy Stock Modal -->
    <div class="modal fade" id="buyModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-plus me-2"></i>Buy Stock</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="buyForm">
                        <div class="mb-3">
                            <label for="stockSymbol" class="form-label">Stock Symbol</label>
                            <input type="text" class="form-control" id="stockSymbol" placeholder="e.g., AAPL, GOOGL, TSLA" required>
                            <div class="form-text text-muted">Enter the stock ticker symbol</div>
                        </div>
                        <div class="mb-3">
                            <label for="stockName" class="form-label">Company Name</label>
                            <input type="text" class="form-control" id="stockName" placeholder="e.g., Apple Inc." required>
                        </div>
                        <div class="mb-3">
                            <label for="shares" class="form-label">Number of Shares</label>
                            <input type="number" class="form-control" id="shares" min="1" placeholder="Enter shares" required>
                        </div>
                        <div class="mb-3">
                            <label for="buyPrice" class="form-label">Price per Share ($)</label>
                            <input type="number" class="form-control" id="buyPrice" step="0.01" placeholder="150.00" required>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Total Cost:</strong> $<span id="totalCost">0.00</span>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="buyStock()">
                        <i class="fas fa-shopping-cart me-2"></i>Buy Stock
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sell Stock Modal -->
    <div class="modal fade" id="sellModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-minus me-2"></i>Sell Stock</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="sellForm">
                        <div class="mb-3">
                            <label class="form-label">Stock Details</label>
                            <div class="p-3 bg-dark rounded">
                                <div class="d-flex justify-content-between">
                                    <span>Symbol:</span>
                                    <strong id="sellStockSymbol">-</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Available Shares:</span>
                                    <strong id="sellAvailableShares">-</strong>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <span>Current Price:</span>
                                    <strong class="text-success" id="sellCurrentPrice">-</strong>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="sellShares" class="form-label">Shares to Sell</label>
                            <input type="number" class="form-control" id="sellShares" min="1" required>
                        </div>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Estimated Proceeds:</strong> $<span id="estimatedProceeds">0.00</span>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" onclick="sellStock()">
                        <i class="fas fa-handshake me-2"></i>Sell Stock
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-3">
                    <h5>EquiZen</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="footer-links">About</a></li>
                        <li><a href="#" class="footer-links">Careers</a></li>
                        <li><a href="#" class="footer-links">Business</a></li>
                        <li><a href="#" class="footer-links">Developers</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Products</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="footer-links">Exchange</a></li>
                        <li><a href="#" class="footer-links">Academy</a></li>
                        <li><a href="#" class="footer-links">Trust Wallet</a></li>
                        <li><a href="#" class="footer-links">API</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Support</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="footer-links">Help Center</a></li>
                        <li><a href="#" class="footer-links">Contact Us</a></li>
                        <li><a href="#" class="footer-links">API Documentation</a></li>
                        <li><a href="#" class="footer-links">Trading Rules</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h5>Legal</h5>
                    <ul class="list-unstyled">
                        <li><a href="#" class="footer-links">Terms of Use</a></li>
                        <li><a href="#" class="footer-links">Privacy Policy</a></li>
                        <li><a href="#" class="footer-links">Cookie Policy</a></li>
                        <li><a href="#" class="footer-links">Risk Warning</a></li>
                    </ul>
                </div>
            </div>
            <hr class="my-4">
            <div class="row">
                <div class="col-md-6">
                    <p class="text-white-50">&copy; 2025 EquiZen. All rights reserved. Powered by MarketStack API</p>
                </div>
                <div class="col-md-6 text-end">
                    <div class="social-links">
                        <a href="#" class="text-white-50 me-3"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-white-50 me-3"><i class="fab fa-telegram"></i></a>
                        <a href="#" class="text-white-50 me-3"><i class="fab fa-reddit"></i></a>
                        <a href="#" class="text-white-50"><i class="fab fa-discord"></i></a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample portfolio data (in a real app, this would come from a database)
        let portfolio = [
            {
                symbol: 'AAPL',
                name: 'Apple Inc.',
                shares: 50,
                avgPrice: 150.00,
                currentPrice: 165.50,
                lastUpdate: new Date()
            },
            {
                symbol: 'GOOGL',
                name: 'Alphabet Inc.',
                shares: 25,
                avgPrice: 2800.00,
                currentPrice: 2950.00,
                lastUpdate: new Date()
            },
            {
                symbol: 'TSLA',
                name: 'Tesla Inc.',
                shares: 30,
                avgPrice: 220.00,
                currentPrice: 215.00,
                lastUpdate: new Date()
            },
            {
                symbol: 'MSFT',
                name: 'Microsoft Corporation',
                shares: 40,
                avgPrice: 300.00,
                currentPrice: 325.75,
                lastUpdate: new Date()
            }
        ];

        let availableCash = 5750.00;
        let selectedStock = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            updatePortfolioDisplay();
            setupEventListeners();
        });

        function setupEventListeners() {
            // Calculate total cost in buy modal
            const sharesInput = document.getElementById('shares');
            const priceInput = document.getElementById('buyPrice');
            
            [sharesInput, priceInput].forEach(input => {
                input.addEventListener('input', calculateTotalCost);
            });

            // Calculate proceeds in sell modal
            document.getElementById('sellShares').addEventListener('input', calculateProceeds);
        }

        function updatePortfolioDisplay() {
            updateStats();
            updateHoldingsTable();
        }

        function updateStats() {
            let totalValue = 0;
            let totalInvested = 0;

            portfolio.forEach(stock => {
                totalValue += stock.shares * stock.currentPrice;
                totalInvested += stock.shares * stock.avgPrice;
            });

            const totalGainLoss = totalValue - totalInvested;
            const gainLossPercent = totalInvested > 0 ? ((totalGainLoss / totalInvested) * 100) : 0;

            document.getElementById('totalValue').textContent = `$${totalValue.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            document.getElementById('totalInvested').textContent = `$${totalInvested.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            document.getElementById('availableCash').textContent = `$${availableCash.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            
            const gainLossElement = document.getElementById('totalGainLoss');
            gainLossElement.textContent = `${totalGainLoss >= 0 ? '+' : ''}$${totalGainLoss.toLocaleString('en-US', {minimumFractionDigits: 2})}`;
            gainLossElement.className = `stat-value ${totalGainLoss >= 0 ? 'positive' : 'negative'}`;
        }

        function updateHoldingsTable() {
            const tbody = document.getElementById('holdingsTableBody');
            
            if (portfolio.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-5">
                            <div class="empty-state">
                                <i class="fas fa-inbox"></i>
                                <h5>No Holdings Yet</h5>
                                <p>Start building your portfolio by buying your first stock!</p>
                                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#buyModal">
                                    <i class="fas fa-plus me-2"></i>Buy Your First Stock
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = portfolio.map(stock => {
                const marketValue = stock.shares * stock.currentPrice;
                const gainLoss = marketValue - (stock.shares * stock.avgPrice);
                const gainLossPercent = ((gainLoss / (stock.shares * stock.avgPrice)) * 100);
                const isPositive = gainLoss >= 0;

                return `
                    <tr>
                        <td>
                            <div>
                                <div class="stock-symbol">${stock.symbol}</div>
                                <div class="stock-name">${stock.name}</div>
                            </div>
                        </td>
                        <td>${stock.shares}</td>
                        <td>$${stock.avgPrice.toFixed(2)}</td>
                        <td>$${stock.currentPrice.toFixed(2)}</td>
                        <td>$${marketValue.toLocaleString('en-US', {minimumFractionDigits: 2})}</td>
                        <td class="${isPositive ? 'positive' : 'negative'}">
                            ${isPositive ? '+' : ''}$${gainLoss.toFixed(2)}
                        </td>
                        <td>
                            <div class="price-change ${isPositive ? 'positive' : 'negative'}">
                                <i class="fas fa-arrow-${isPositive ? 'up' : 'down'}"></i>
                                ${isPositive ? '+' : ''}${gainLossPercent.toFixed(2)}%
                            </div>
                        </td>
                        <td>
                            <button class="action-btn" onclick="openSellModal('${stock.symbol}')">
                                <i class="fas fa-minus me-1"></i>Sell
                            </button>
                            <button class="action-btn" onclick="viewDetails('${stock.symbol}')">
                                <i class="fas fa-chart-line me-1"></i>Details
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function calculateTotalCost() {
            const shares = parseFloat(document.getElementById('shares').value) || 0;
            const price = parseFloat(document.getElementById('buyPrice').value) || 0;
            const total = shares * price;
            document.getElementById('totalCost').textContent = total.toFixed(2);
        }

        function calculateProceeds() {
            const shares = parseFloat(document.getElementById('sellShares').value) || 0;
            const currentPrice = parseFloat(document.getElementById('sellCurrentPrice').textContent.replace('$', '')) || 0;
            const proceeds = shares * currentPrice;
            document.getElementById('estimatedProceeds').textContent = proceeds.toFixed(2);
        }

        function buyStock() {
            const symbol = document.getElementById('stockSymbol').value.toUpperCase();
            const name = document.getElementById('stockName').value;
            const shares = parseInt(document.getElementById('shares').value);
            const price = parseFloat(document.getElementById('buyPrice').value);
            const totalCost = shares * price;

            if (!symbol || !name || !shares || !price) {
                alert('Please fill in all fields');
                return;
            }

            if (totalCost > availableCash) {
                alert('Insufficient funds! You need $' + totalCost.toFixed(2) + ' but only have $' + availableCash.toFixed(2));
                return;
            }

            // Check if stock already exists in portfolio
            const existingStock = portfolio.find(stock => stock.symbol === symbol);
            
            if (existingStock) {
                // Update existing holding
                const totalShares = existingStock.shares + shares;
                const totalValue = (existingStock.shares * existingStock.avgPrice) + (shares * price);
                existingStock.avgPrice = totalValue / totalShares;
                existingStock.shares = totalShares;
            } else {
                // Add new stock to portfolio
                portfolio.push({
                    symbol: symbol,
                    name: name,
                    shares: shares,
                    avgPrice: price,
                    currentPrice: price, // Initially same as buy price
                    lastUpdate: new Date()
                });
            }

            availableCash -= totalCost;
            updatePortfolioDisplay();
            
            // Clear form and close modal
            document.getElementById('buyForm').reset();
            document.getElementById('totalCost').textContent = '0.00';
            bootstrap.Modal.getInstance(document.getElementById('buyModal')).hide();
            
            // Show success message
            showNotification(`Successfully bought ${shares} shares of ${symbol} for $${totalCost.toFixed(2)}`, 'success');
        }

        function openSellModal(symbol) {
            const stock = portfolio.find(s => s.symbol === symbol);
            if (!stock) return;

            selectedStock = stock;
            document.getElementById('sellStockSymbol').textContent = stock.symbol;
            document.getElementById('sellAvailableShares').textContent = stock.shares;
            document.getElementById('sellCurrentPrice').textContent = `$${stock.currentPrice.toFixed(2)}`;
            document.getElementById('sellShares').max = stock.shares;
            document.getElementById('sellShares').value = '';
            document.getElementById('estimatedProceeds').textContent = '0.00';

            new bootstrap.Modal(document.getElementById('sellModal')).show();
        }

        function sellStock() {
            if (!selectedStock) return;

            const sharesToSell = parseInt(document.getElementById('sellShares').value);
            
            if (!sharesToSell || sharesToSell > selectedStock.shares) {
                alert('Invalid number of shares');
                return;
            }

            const proceeds = sharesToSell * selectedStock.currentPrice;
            
            if (sharesToSell === selectedStock.shares) {
                // Remove stock completely
                portfolio = portfolio.filter(stock => stock.symbol !== selectedStock.symbol);
            } else {
                // Reduce shares
                selectedStock.shares -= sharesToSell;
            }

            availableCash += proceeds;
            updatePortfolioDisplay();
            
            bootstrap.Modal.getInstance(document.getElementById('sellModal')).hide();
            showNotification(`Successfully sold ${sharesToSell} shares of ${selectedStock.symbol} for $${proceeds.toFixed(2)}`, 'success');
            
            selectedStock = null;
        }

        function refreshPrices() {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<div class="loading-spinner me-2"></div>Refreshing...';
            button.disabled = true;

            // Simulate price updates (in real app, this would call an API)
            setTimeout(() => {
                portfolio.forEach(stock => {
                    // Simulate price changes between -5% to +5%
                    const changePercent = (Math.random() - 0.5) * 0.1; // -5% to +5%
                    stock.currentPrice = stock.currentPrice * (1 + changePercent);
                    stock.lastUpdate = new Date();
                });
                
                updatePortfolioDisplay();
                button.innerHTML = originalText;
                button.disabled = false;
                showNotification('Prices updated successfully!', 'success');
            }, 2000);
        }

        function viewDetails(symbol) {
            // In a real app, this would navigate to a detailed stock page
            showNotification(`Viewing details for ${symbol} - Feature coming soon!`, 'info');
        }

        function exportPortfolio() {
            const portfolioData = {
                holdings: portfolio,
                availableCash: availableCash,
                exportDate: new Date().toISOString(),
                totalValue: portfolio.reduce((sum, stock) => sum + (stock.shares * stock.currentPrice), 0)
            };
            
            const dataStr = JSON.stringify(portfolioData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `portfolio_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            showNotification('Portfolio exported successfully!', 'success');
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} alert-dismissible fade show position-fixed`;
            notification.style.cssText = `
                top: 20px;
                right: 20px;
                z-index: 9999;
                min-width: 300px;
                max-width: 400px;
            `;
            
            const icon = type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle';
            
            notification.innerHTML = `
                <i class="fas fa-${icon} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // Simulate real-time price updates every 30 seconds
        setInterval(() => {
            portfolio.forEach(stock => {
                // Small random price fluctuation
                const changePercent = (Math.random() - 0.5) * 0.02; // -1% to +1%
                stock.currentPrice = Math.max(0.01, stock.currentPrice * (1 + changePercent));
                stock.lastUpdate = new Date();
            });
            updatePortfolioDisplay();
        }, 30000);

        // Auto-save portfolio to localStorage every minute (if localStorage was available)
        // Note: In Claude artifacts, localStorage is not available, so this is just for demonstration
        function savePortfolio() {
            try {
                const portfolioState = {
                    portfolio: portfolio,
                    availableCash: availableCash,
                    lastSaved: new Date().toISOString()
                };
                // localStorage.setItem('stockPortfolio', JSON.stringify(portfolioState));
                console.log('Portfolio would be saved:', portfolioState);
            } catch (error) {
                console.log('Portfolio save simulation:', error);
            }
        }

        // Save every minute
        setInterval(savePortfolio, 60000);

        // Add some sample transactions on page load for demo purposes
        function addSampleData() {
            // This function demonstrates how the portfolio would look with some transactions
            // In a real app, this data would come from a database
            console.log('Portfolio initialized with sample data');
        }

        // Initialize sample data
        addSampleData();
    </script>
</body>
</html>